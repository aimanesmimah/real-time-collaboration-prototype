!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.sharedbAce=e():t.sharedbAce=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}/**
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @fileOverview
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @name sharedb-ace.js
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @author Jethro Kuan <jethrokuan95@gmail.com>
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @license MIT
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */
function l(t){this.message=t,this.name="IllegalArgumentException"}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(1),h=i(a),u=n(2),p=i(u),f=n(3),d=i(f),v=n(18),g=i(v),y=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(i.id=t,null!==n.pluginWsUrl&&(i.pluginWS=new h.default(n.pluginWsUrl)),null===n.WsUrl)throw new l("wsUrl not provided.");i.WS=new h.default(n.WsUrl);var s=new d.default.Connection(i.WS);if(null===n.namespace)throw new l("namespace not provided.");var c=n.namespace,a=s.get(c,t),u=function(t){if(t)throw t;if(null===a.type)throw new Error("ShareDB document uninitialized. Please check if you have the correct id or that you have initialized the document in the server.");i.emit("ready")};return a.subscribe(u.bind(a)),i.doc=a,i.connections={},i}return s(e,t),c(e,[{key:"add",value:function(t,e,n){var i=e||[],r=new g.default({ace:t,doc:this.doc,path:i,pluginWS:this.pluginWS,id:this.id,plugins:n});this.connections[e.join("-")]=r}}]),e}(p.default);e.default=y},function(t,e){"use strict";var n=function(t){return t&&2===t.CLOSING},i=function(){return"undefined"!=typeof WebSocket&&n(WebSocket)},r=function(){return{constructor:i()?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1}},o=function(t,e,n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){t[n]=e},enumerable:!0,configurable:!0})},s=function(t){return t.minReconnectionDelay+Math.random()*t.minReconnectionDelay},l=function(t,e){var n=e*t.reconnectionDelayGrowFactor;return n>t.maxReconnectionDelay?t.maxReconnectionDelay:n},c=["onopen","onclose","onmessage","onerror"],a=function(t,e,n){Object.keys(n).forEach(function(e){n[e].forEach(function(n){var i=n[0],r=n[1];t.addEventListener(e,i,r)})}),e&&c.forEach(function(n){t[n]=e[n]})},h=function(t,e,i){var c=this;void 0===i&&(i={});var u,p,f=0,d=0,v=!0,g=null,y={};if(!(this instanceof h))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var m=r();if(Object.keys(m).filter(function(t){return i.hasOwnProperty(t)}).forEach(function(t){return m[t]=i[t]}),!n(m.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var b=m.debug?function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return console.log.apply(console,["RWS:"].concat(t))}:function(){},_=function(t,e){return setTimeout(function(){var n=new Error(e);n.code=t,Array.isArray(y.error)&&y.error.forEach(function(t){var e=t[0];return e(n)}),u.onerror&&u.onerror(n)},0)},w=function(){return b("close"),d++,b("retries count:",d),d>m.maxRetries?void _("EHOSTDOWN","Too many failed connection attempts"):(f=f?l(m,f):s(m),b("reconnectDelay:",f),void(v&&setTimeout(E,f)))},E=function(){b("connect");var n=u;u=new m.constructor(t,e),p=setTimeout(function(){b("timeout"),u.close(),_("ETIMEDOUT","Connection timeout")},m.connectionTimeout),b("bypass properties");for(var i in u)["addEventListener","removeEventListener","close","send"].indexOf(i)<0&&o(u,c,i);u.addEventListener("open",function(){clearTimeout(p),b("open"),f=s(m),b("reconnectDelay:",f),d=0}),u.addEventListener("close",w),a(u,n,y),u.onclose=u.onclose||g,g=null};b("init"),E(),this.close=function(t,e,n){void 0===t&&(t=1e3),void 0===e&&(e="");var i=void 0===n?{}:n,r=i.keepClosed,o=void 0!==r&&r,s=i.fastClose,l=void 0===s||s,c=i.delay,a=void 0===c?0:c;if(a&&(f=a),v=!o,u.close(t,e),l){var h={code:t,reason:e,wasClean:!0};w(),u.removeEventListener("close",w),Array.isArray(y.close)&&y.close.forEach(function(t){var e=t[0],n=t[1];e(h),u.removeEventListener("close",e,n)}),u.onclose&&(g=u.onclose,u.onclose(h),u.onclose=null)}},this.send=function(t){u.send(t)},this.addEventListener=function(t,e,n){Array.isArray(y[t])?y[t].some(function(t){var n=t[0];return n===e})||y[t].push([e,n]):y[t]=[[e,n]],u.addEventListener(t,e,n)},this.removeEventListener=function(t,e,n){Array.isArray(y[t])&&(y[t]=y[t].filter(function(t){var n=t[0];return n!==e})),u.removeEventListener(t,e,n)}};t.exports=h},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r={emitDelay:10,strictMode:!1},o=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?r:arguments[0];n(this,t);var i=void 0,o=void 0;i=e.hasOwnProperty("emitDelay")?e.emitDelay:r.emitDelay,this._emitDelay=i,o=e.hasOwnProperty("strictMode")?e.strictMode:r.strictMode,this._strictMode=o,this._listeners={},this.events=[]}return i(t,[{key:"_addListenner",value:function(t,e,n){if("function"!=typeof e)throw TypeError("listener must be a function");this.events.indexOf(t)===-1?(this._listeners[t]=[{once:n,fn:e}],this.events.push(t)):this._listeners[t].push({once:n,fn:e})}},{key:"on",value:function(t,e){this._addListenner(t,e,!1)}},{key:"once",value:function(t,e){this._addListenner(t,e,!0)}},{key:"off",value:function(t,e){var n=this,i=this.events.indexOf(t),r=t&&i!==-1;r&&(e?!function(){var r=[],o=n._listeners[t];o.forEach(function(t,n){t.fn===e&&r.unshift(n)}),r.forEach(function(t){o.splice(t,1)}),o.length||(n.events.splice(i,1),delete n._listeners[t])}():(delete this._listeners[t],this.events.splice(i,1)))}},{key:"_applyEvents",value:function(t,e){var n=this._listeners[t];if(n&&n.length){var i=[];n.forEach(function(t,n){t.fn.apply(null,e),t.once&&i.unshift(n)}),i.forEach(function(t){n.splice(t,1)})}else if(this._strictMode)throw"No listeners specified for event: "+t}},{key:"emit",value:function(t){for(var e=this,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this._emitDelay?setTimeout(function(){e._applyEvents.call(e,t,i)},this._emitDelay):this._applyEvents(t,i)}},{key:"emitSync",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._applyEvents(t,n)}},{key:"destroy",value:function(){this._listeners={},this.events=[]}}]),t}();t.exports=o},function(t,e,n){e.Connection=n(4),e.Doc=n(6),e.Error=n(9),e.Query=n(16),e.types=n(11)},function(t,e,n){(function(e){function i(t){c.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.queries={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.bindToSocket(t)}function r(t){return t.hasPending()}function o(t){return t.hasWritePending()}var s=n(6),l=n(16),c=n(7),a=n(9),h=n(11),u=n(17);t.exports=i,c.mixin(i),i.prototype.bindToSocket=function(t){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=t,this.state=0===t.readyState||1===t.readyState?"connecting":"disconnected",this.canSend=!1;var n=this;t.onmessage=function(t){try{var i="string"==typeof t.data?JSON.parse(t.data):t.data}catch(e){return void console.warn("Failed to parse message",t)}n.debug&&console.log("RECV",JSON.stringify(i));var r={data:i};if(n.emit("receive",r),r.data)try{n.handleMessage(r.data)}catch(t){e.nextTick(function(){n.emit("error",t)})}},t.onopen=function(){n._setState("connecting")},t.onerror=function(t){n.emit("connection error",t)},t.onclose=function(t){"closed"===t||"Closed"===t?n._setState("closed",t):"stopped"===t||"Stopped by server"===t?n._setState("stopped",t):n._setState("disconnected",t)}},i.prototype.handleMessage=function(t){var e=null;switch(t.error&&(e=new Error(t.error.message),e.code=t.error.code,e.data=t,delete t.error),t.a){case"init":return 1!==t.protocol?(e=new a(4019,"Invalid protocol version"),this.emit("error",e)):h.map[t.type]!==h.defaultType?(e=new a(4020,"Invalid default type"),this.emit("error",e)):"string"!=typeof t.id?(e=new a(4021,"Invalid client id"),this.emit("error",e)):(this.id=t.id,void this._setState("connected"));case"qf":var n=this.queries[t.id];return void(n&&n._handleFetch(e,t.data,t.extra));case"qs":var n=this.queries[t.id];return void(n&&n._handleSubscribe(e,t.data,t.extra));case"qu":return;case"q":var n=this.queries[t.id];if(!n)return;return e?n._handleError(e):(t.diff&&n._handleDiff(t.diff),void(t.hasOwnProperty("extra")&&n._handleExtra(t.extra)));case"bf":return this._handleBulkMessage(t,"_handleFetch");case"bs":return this._handleBulkMessage(t,"_handleSubscribe");case"bu":return this._handleBulkMessage(t,"_handleUnsubscribe");case"f":var i=this.getExisting(t.c,t.d);return void(i&&i._handleFetch(e,t.data));case"s":var i=this.getExisting(t.c,t.d);return void(i&&i._handleSubscribe(e,t.data));case"u":var i=this.getExisting(t.c,t.d);return void(i&&i._handleUnsubscribe(e));case"op":var i=this.getExisting(t.c,t.d);return void(i&&i._handleOp(e,t));default:console.warn("Ignorning unrecognized message",t)}},i.prototype._handleBulkMessage=function(t,e){if(t.data)for(var n in t.data){var i=this.getExisting(t.c,n);i&&i[e](t.error,t.data[n])}else if(Array.isArray(t.b))for(var r=0;r<t.b.length;r++){var n=t.b[r],i=this.getExisting(t.c,n);i&&i[e](t.error)}else if(t.b)for(var n in t.b){var i=this.getExisting(t.c,n);i&&i[e](t.error)}else console.error("Invalid bulk message",t)},i.prototype._reset=function(){this.seq=1,this.id=null,this.agent=null},i.prototype._setState=function(t,e){if(this.state!==t){if("connecting"===t&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===t&&"connecting"!==this.state){var n=new a(5007,"Cannot transition directly from "+this.state+" to "+t);return this.emit("error",n)}this.state=t,this.canSend="connected"===t,"disconnected"!==t&&"stopped"!==t&&"closed"!==t||this._reset(),this.startBulk();for(var i in this.queries){var r=this.queries[i];r._onConnectionStateChanged()}for(var o in this.collections){var s=this.collections[o];for(var i in s)s[i]._onConnectionStateChanged()}this.endBulk(),this.emit(t,e),this.emit("state",t,e)}},i.prototype.startBulk=function(){this.bulk||(this.bulk={})},i.prototype.endBulk=function(){if(this.bulk)for(var t in this.bulk){var e=this.bulk[t];this._sendBulk("f",t,e.f),this._sendBulk("s",t,e.s),this._sendBulk("u",t,e.u)}this.bulk=null},i.prototype._sendBulk=function(t,e,n){if(n){var i,r=[],o={},s=0;for(var l in n){var c=n[l];null==c?r.push(l):(o[l]=c,i=l,s++)}if(1===r.length){var l=r[0];this.send({a:t,c:e,d:l})}else r.length&&this.send({a:"b"+t,c:e,b:r});if(1===s){var a=o[i];this.send({a:t,c:e,d:i,v:a})}else s&&this.send({a:"b"+t,c:e,b:o})}},i.prototype._sendAction=function(t,e,n){if(this._addDoc(e),this.bulk){var i=this.bulk[e.collection]||(this.bulk[e.collection]={}),r=i[t]||(i[t]={}),o=r.hasOwnProperty(e.id);return r[e.id]=n,o}var s={a:t,c:e.collection,d:e.id,v:n};this.send(s)},i.prototype.sendFetch=function(t){return this._sendAction("f",t,t.version)},i.prototype.sendSubscribe=function(t){return this._sendAction("s",t,t.version)},i.prototype.sendUnsubscribe=function(t){return this._sendAction("u",t)},i.prototype.sendOp=function(t,e){this._addDoc(t);var n={a:"op",c:t.collection,d:t.id,v:t.version,src:e.src,seq:e.seq};e.op&&(n.op=e.op),e.create&&(n.create=e.create),e.del&&(n.del=e.del),this.send(n)},i.prototype.send=function(t){this.debug&&console.log("SEND",JSON.stringify(t)),this.emit("send",t),this.socket.send(JSON.stringify(t))},i.prototype.close=function(){this.socket.close()},i.prototype.getExisting=function(t,e){if(this.collections[t])return this.collections[t][e]},i.prototype.get=function(t,e){var n=this.collections[t]||(this.collections[t]={}),i=n[e];return i||(i=n[e]=new s(this,t,e),this.emit("doc",i)),i},i.prototype._destroyDoc=function(t){var e=this.collections[t.collection];e&&(delete e[t.id],u.hasKeys(e)||delete this.collections[t.collection])},i.prototype._addDoc=function(t){var e=this.collections[t.collection];e||(e=this.collections[t.collection]={}),e[t.id]!==t&&(e[t.id]=t)},i.prototype._createQuery=function(t,e,n,i,r){var o=this.nextQueryId++,s=new l(t,this,o,e,n,i,r);return this.queries[o]=s,s.send(),s},i.prototype._destroyQuery=function(t){delete this.queries[t.id]},i.prototype.createFetchQuery=function(t,e,n,i){return this._createQuery("qf",t,e,n,i)},i.prototype.createSubscribeQuery=function(t,e,n,i){return this._createQuery("qs",t,e,n,i)},i.prototype.hasPending=function(){return!(!this._firstDoc(r)&&!this._firstQuery(r))},i.prototype.hasWritePending=function(){return!!this._firstDoc(o)},i.prototype.whenNothingPending=function(t){var n=this._firstDoc(r);if(n)return void n.once("nothing pending",this._nothingPendingRetry(t));var i=this._firstQuery(r);return i?void i.once("ready",this._nothingPendingRetry(t)):void e.nextTick(t)},i.prototype._nothingPendingRetry=function(t){var n=this;return function(){e.nextTick(function(){n.whenNothingPending(t)})}},i.prototype._firstDoc=function(t){for(var e in this.collections){var n=this.collections[e];for(var i in n){var r=n[i];if(t(r))return r}}},i.prototype._firstQuery=function(t){for(var e in this.queries){var n=this.queries[e];if(t(n))return n}}}).call(e,n(5))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(t){if(h===setTimeout)return setTimeout(t,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function o(t){if(u===clearTimeout)return clearTimeout(t);if((u===i||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{return u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}function s(){v&&f&&(v=!1,f.length?d=f.concat(d):g=-1,d.length&&l())}function l(){if(!v){var t=r(s);v=!0;for(var e=d.length;e;){for(f=d,d=[];++g<e;)f&&f[g].run();g=-1,e=d.length}f=null,v=!1,o(t)}}function c(t,e){this.fun=t,this.array=e}function a(){}var h,u,p=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{u="function"==typeof clearTimeout?clearTimeout:i}catch(t){u=i}}();var f,d=[],v=!1,g=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new c(t,e)),1!==d.length||v||r(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=a,p.addListener=a,p.once=a,p.off=a,p.removeListener=a,p.removeAllListeners=a,p.emit=a,p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(t,e,n){(function(e){function i(t,e,n){c.EventEmitter.call(this),this.connection=t,this.collection=e,this.id=n,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function r(t,e,n){if(e){var i=t.pop();t.push(function(t){i&&i(t),n&&n(t)})}else t.push(n)}function o(t){delete t.op,delete t.create,delete t.del}function s(t,e){if(t.del)return o(e);if(e.del)return new a(4017,"Document was deleted");if(e.create)return new a(4018,"Document alredy created");if(e.op){if(t.create)return new a(4018,"Document already created");if(t.type.transformX){var n=t.type.transformX(t.op,e.op);t.op=n[0],e.op=n[1]}else{var i=t.type.transform(t.op,e.op,"left"),r=t.type.transform(e.op,t.op,"right");t.op=i,e.op=r}}}function l(t,e){for(var n=!1,i=0;i<t.length;i++){var r=t[i];r&&(r(e),n=!0)}return n}var c=n(7),a=n(9),h=n(11);t.exports=i,c.mixin(i),i.prototype.destroy=function(t){var e=this;e.whenNothingPending(function(){return e.connection._destroyDoc(e),e.wantSubscribe?e.unsubscribe(t):void(t&&t())})},i.prototype._setType=function(t){if("string"==typeof t&&(t=h.map[t]),t)this.type=t;else{if(null!==t){var e=new a(4008,"Missing type "+t);return this.emit("error",e)}this.type=t,this.data=void 0}},i.prototype.ingestSnapshot=function(t,e){if(!t)return e&&e();if("number"!=typeof t.v){var n=new a(5008,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return e?e(n):this.emit("error",n)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return e&&this.once("no write pending",e);var n=new a(5009,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return e?e(n):this.emit("error",n)}return t.v>this.version?this.fetch(e):e&&e()}if(this.version>t.v)return e&&e();this.version=t.v;var i=void 0===t.type?h.defaultType:t.type;this._setType(i),this.data=this.type&&this.type.deserialize?this.type.deserialize(t.data):t.data,this.emit("load"),e&&e()},i.prototype.whenNothingPending=function(t){return this.hasPending()?void this.once("nothing pending",t):void t()},i.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},i.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},i.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},i.prototype._emitResponseError=function(t,e){return e?(e(t),void this._emitNothingPending()):(this._emitNothingPending(),void this.emit("error",t))},i.prototype._handleFetch=function(t,e){var n=this.inflightFetch.shift();return t?this._emitResponseError(t,n):(this.ingestSnapshot(e,n),void this._emitNothingPending())},i.prototype._handleSubscribe=function(t,e){var n=this.inflightSubscribe.shift();return t?this._emitResponseError(t,n):(this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(e,n),void this._emitNothingPending())},i.prototype._handleUnsubscribe=function(t){var e=this.inflightUnsubscribe.shift();return t?this._emitResponseError(t,e):(e&&e(),void this._emitNothingPending())},i.prototype._handleOp=function(t,e){if(t)return this.inflightOp?(4002===t.code&&(t=null),this._rollback(t)):this.emit("error",t);if(this.inflightOp&&e.src===this.inflightOp.src&&e.seq===this.inflightOp.seq)return void this._opAcknowledged(e);if(null==this.version||e.v>this.version)return void this.fetch();if(!(e.v<this.version)){if(this.inflightOp){var n=s(this.inflightOp,e);if(n)return this._hardRollback(n)}for(var i=0;i<this.pendingOps.length;i++){var n=s(this.pendingOps[i],e);if(n)return this._hardRollback(n)}this.version++,this._otApply(e,!1)}},i.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var t=this.inflightUnsubscribe;this.inflightUnsubscribe=[],l(t)}},i.prototype._resubscribe=function(){var t=this.pendingFetch;return this.pendingFetch=[],this.wantSubscribe?t.length?void this.subscribe(function(e){l(t,e)}):void this.subscribe():void(t.length&&this.fetch(function(e){l(t,e)}))},i.prototype.fetch=function(t){if(this.connection.canSend){var e=this.connection.sendFetch(this);return void r(this.inflightFetch,e,t)}this.pendingFetch.push(t)},i.prototype.subscribe=function(t){if(this.wantSubscribe=!0,this.connection.canSend){var e=this.connection.sendSubscribe(this);return void r(this.inflightSubscribe,e,t)}this.pendingFetch.push(t)},i.prototype.unsubscribe=function(t){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var n=this.connection.sendUnsubscribe(this);return void r(this.inflightUnsubscribe,n,t)}t&&e.nextTick(t)},i.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},i.prototype._otApply=function(t,e){if(t.op){if(!this.type){var n=new a(4015,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);return this.emit("error",n)}if(!e&&this.type===h.defaultType&&t.op.length>1){this.applyStack||(this.applyStack=[]);for(var i=this.applyStack.length,r=0;r<t.op.length;r++){for(var o=t.op[r],l={op:[o]},c=i;c<this.applyStack.length;c++){var u=s(this.applyStack[c],l);if(u)return this._hardRollback(u)}this.emit("before op",l.op,e),this.data=this.type.apply(this.data,l.op),this.emit("op",l.op,e)}return void this._popApplyStack(i)}return this.emit("before op",t.op,e),this.data=this.type.apply(this.data,t.op),void this.emit("op",t.op,e)}if(t.create)return this._setType(t.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(t.create.data):this.type.deserialize(this.type.create(t.create.data)):this.type.create(t.create.data),void this.emit("create",e);if(t.del){var p=this.data;return this._setType(null),void this.emit("del",p,e)}},i.prototype._sendOp=function(){var t=this.connection.id;if(t){this.inflightOp||(this.inflightOp=this.pendingOps.shift());var e=this.inflightOp;if(!e){var n=new a(5010,"No op to send on call to _sendOp");return this.emit("error",n)}e.sentAt=Date.now(),e.retries=null==e.retries?0:e.retries+1,null==e.seq&&(e.seq=this.connection.seq++),this.connection.sendOp(this,e),null==e.src&&(e.src=t)}},i.prototype._submit=function(t,n,i){if(n||(n=!0),t.op){if(!this.type){var r=new a(4015,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return i?i(r):this.emit("error",r)}this.type.normalize&&(t.op=this.type.normalize(t.op))}this._pushOp(t,i),this._otApply(t,n);var o=this;e.nextTick(function(){o.flush()})},i.prototype._pushOp=function(t,e){if(this.applyStack)this.applyStack.push(t);else{var n=this._tryCompose(t);if(n)return void n.callbacks.push(e)}t.type=this.type,t.callbacks=[e],this.pendingOps.push(t)},i.prototype._popApplyStack=function(t){if(t>0)return void(this.applyStack.length=t);var e=this.applyStack[0];if(this.applyStack=null,e){var n=this.pendingOps.indexOf(e);if(n!==-1)for(var i=this.pendingOps.splice(n),n=0;n<i.length;n++){var e=i[n],r=this._tryCompose(e);r?r.callbacks=r.callbacks.concat(e.callbacks):this.pendingOps.push(e)}}},i.prototype._tryCompose=function(t){if(!this.preventCompose){var e=this.pendingOps[this.pendingOps.length-1];if(e)return e.create&&t.op?(e.create.data=this.type.apply(e.create.data,t.op),e):e.op&&t.op&&this.type.compose?(e.op=this.type.compose(e.op,t.op),e):void 0}},i.prototype.submitOp=function(t,e,n){"function"==typeof e&&(n=e,e=null);var i={op:t},r=e&&e.source;this._submit(i,r,n)},i.prototype.create=function(t,e,n,i){if("function"==typeof e?(i=e,n=null,e=null):"function"==typeof n&&(i=n,n=null),e||(e=h.defaultType.uri),this.type){var r=new a(4016,"Document already exists");return i?i(r):this.emit("error",r)}var o={create:{type:e,data:t}},s=n&&n.source;this._submit(o,s,i)},i.prototype.del=function(t,e){if("function"==typeof t&&(e=t,t=null),!this.type){var n=new a(4015,"Document does not exist");return e?e(n):this.emit("error",n)}var i={del:!0},r=t&&t.source;this._submit(i,r,e)},i.prototype.pause=function(){this.paused=!0},i.prototype.resume=function(){this.paused=!1,this.flush()},i.prototype._opAcknowledged=function(t){if(this.inflightOp.create)this.version=t.v;else if(t.v!==this.version)return console.warn("Invalid version from server. Expected: "+this.version+" Received: "+t.v,t),this.fetch();this.version++,this._clearInflightOp()},i.prototype._rollback=function(t){var e=this.inflightOp;if(e.op&&e.type.invert){e.op=e.type.invert(e.op);for(var n=0;n<this.pendingOps.length;n++){var i=s(this.pendingOps[n],e);if(i)return this._hardRollback(i)}return this._otApply(e,!1),void this._clearInflightOp(t)}this._hardRollback(t)},i.prototype._hardRollback=function(t){var e=this.inflightOp,n=this.pendingOps;this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var i=this;this.fetch(function(){for(var r=e&&l(e.callbacks,t),o=0;o<n.length;o++)l(n[o].callbacks,t);if(t&&!r)return i.emit("error",t)})},i.prototype._clearInflightOp=function(t){var e=l(this.inflightOp.callbacks,t);if(this.inflightOp=null,this.flush(),this._emitNothingPending(),t&&!e)return this.emit("error",t)}}).call(e,n(5))},function(t,e,n){function i(t){for(var e in r.prototype)t.prototype[e]=r.prototype[e]}var r=n(8).EventEmitter;e.EventEmitter=r,e.mixin=i},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function r(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!r(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,r,l,c,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:l=Array.prototype.slice.call(arguments,1),n.apply(this,l)}else if(o(n))for(l=Array.prototype.slice.call(arguments,1),a=n.slice(),r=a.length,c=0;c<r;c++)a[c].apply(this,l);return!0},n.prototype.addListener=function(t,e){var r;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,r,s,l;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(l=s;l-- >0;)if(n[l]===e||n[l].listener&&n[l].listener===e){r=l;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){function i(t,e){i.super.call(this,e),this.code=t}var r=n(10);r(i),t.exports=i},function(t,e){"use strict";function n(t){t&&r(this,"message",{configurable:!0,value:t,writable:!0});var e=this.constructor.name;e&&e!==this.name&&r(this,"name",{configurable:!0,value:e,writable:!0}),o(this,this.constructor)}function i(t,e){if(null==e||e===Error)e=n;else if("function"!=typeof e)throw new TypeError("super_ should be a function");var i;if("string"==typeof t)i=t,t=function(){e.apply(this,arguments)},s&&(s(t,i),i=null);else if("function"!=typeof t)throw new TypeError("constructor should be either a string or a function");t.super_=t.super=e;var r={constructor:{configurable:!0,value:t,writable:!0}};return null!=i&&(r.name={configurable:!0,value:i,writable:!0}),t.prototype=Object.create(e.prototype,r),t}var r=Object.defineProperty,o=Error.captureStackTrace;o||(o=function(t){var e=new Error;r(t,"stack",{configurable:!0,get:function(){var t=e.stack;return r(this,"stack",{value:t}),t},set:function(e){r(t,"stack",{configurable:!0,value:e,writable:!0})}})}),n.prototype=Object.create(Error.prototype,{constructor:{configurable:!0,value:n,writable:!0}});var s=function(){function t(t,e){return r(t,"name",{configurable:!0,value:e})}try{var e=function(){};if(t(e,"foo"),"foo"===e.name)return t}catch(t){}}();e=t.exports=i,e.BaseError=n},function(t,e,n){e.defaultType=n(12).type,e.map={},e.register=function(t){t.name&&(e.map[t.name]=t),t.uri&&(e.map[t.uri]=t)},e.register(e.defaultType)},function(t,e,n){t.exports={type:n(13)}},function(t,e,n){function i(t){t.t="text0";var e={p:t.p.pop()};null!=t.si&&(e.i=t.si),null!=t.sd&&(e.d=t.sd),t.o=[e]}function r(t){t.p.push(t.o[0].p),null!=t.o[0].i&&(t.si=t.o[0].i),null!=t.o[0].d&&(t.sd=t.o[0].d),delete t.t,delete t.o}var o=function(t){return"[object Array]"==Object.prototype.toString.call(t)},s=function(t){return!!t&&t.constructor===Object},l=function(t){return JSON.parse(JSON.stringify(t))},c={name:"json0",uri:"http://sharejs.org/types/JSONv0"},a={};c.registerSubtype=function(t){a[t.name]=t},c.create=function(t){return void 0===t?null:l(t)},c.invertComponent=function(t){var e={p:t.p};return t.t&&a[t.t]&&(e.t=t.t,e.o=a[t.t].invert(t.o)),void 0!==t.si&&(e.sd=t.si),void 0!==t.sd&&(e.si=t.sd),void 0!==t.oi&&(e.od=t.oi),void 0!==t.od&&(e.oi=t.od),void 0!==t.li&&(e.ld=t.li),void 0!==t.ld&&(e.li=t.ld),void 0!==t.na&&(e.na=-t.na),void 0!==t.lm&&(e.lm=t.p[t.p.length-1],e.p=t.p.slice(0,t.p.length-1).concat([t.lm])),e},c.invert=function(t){for(var e=t.slice().reverse(),n=[],i=0;i<e.length;i++)n.push(c.invertComponent(e[i]));return n},c.checkValidOp=function(t){for(var e=0;e<t.length;e++)if(!o(t[e].p))throw new Error("Missing path")},c.checkList=function(t){if(!o(t))throw new Error("Referenced element not a list")},c.checkObj=function(t){if(!s(t))throw new Error("Referenced element not an object (it was "+JSON.stringify(t)+")")},c.apply=function(t,e){c.checkValidOp(e),e=l(e);for(var n={data:t},r=0;r<e.length;r++){var o=e[r];null==o.si&&null==o.sd||i(o);for(var s=null,h=null,u=n,p="data",f=0;f<o.p.length;f++){var d=o.p[f];if(s=u,h=p,u=u[p],p=d,null==s)throw new Error("Path invalid")}if(o.t&&void 0!==o.o&&a[o.t])u[p]=a[o.t].apply(u[p],o.o);else if(void 0!==o.na){if("number"!=typeof u[p])throw new Error("Referenced element not a number");u[p]+=o.na}else if(void 0!==o.li&&void 0!==o.ld)c.checkList(u),u[p]=o.li;else if(void 0!==o.li)c.checkList(u),u.splice(p,0,o.li);else if(void 0!==o.ld)c.checkList(u),u.splice(p,1);else if(void 0!==o.lm){if(c.checkList(u),o.lm!=p){var v=u[p];u.splice(p,1),u.splice(o.lm,0,v)}}else if(void 0!==o.oi)c.checkObj(u),
u[p]=o.oi;else{if(void 0===o.od)throw new Error("invalid / missing instruction in op");c.checkObj(u),delete u[p]}}return n.data},c.shatter=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n]]);return e},c.incrementalApply=function(t,e,n){for(var i=0;i<e.length;i++){var r=[e[i]];t=c.apply(t,r),n(r,t)}return t};var h=c.pathMatches=function(t,e,n){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i]&&(!n||i!==t.length-1))return!1;return!0};c.append=function(t,e){if(e=l(e),0===t.length)return void t.push(e);var n=t[t.length-1];if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(i(e),i(n)),h(e.p,n.p))if(e.t&&n.t&&e.t===n.t&&a[e.t]){if(n.o=a[e.t].compose(n.o,e.o),null!=e.si||null!=e.sd){for(var o=e.p,s=0;s<n.o.length-1;s++)e.o=[n.o.pop()],e.p=o.slice(),r(e),t.push(e);r(n)}}else null!=n.na&&null!=e.na?t[t.length-1]={p:n.p,na:n.na+e.na}:void 0!==n.li&&void 0===e.li&&e.ld===n.li?void 0!==n.ld?delete n.li:t.pop():void 0!==n.od&&void 0===n.oi&&void 0!==e.oi&&void 0===e.od?n.oi=e.oi:void 0!==n.oi&&void 0!==e.od?void 0!==e.oi?n.oi=e.oi:void 0!==n.od?delete n.oi:t.pop():void 0!==e.lm&&e.p[e.p.length-1]===e.lm||t.push(e);else null==e.si&&null==e.sd||null==n.si&&null==n.sd||(r(e),r(n)),t.push(e)},c.compose=function(t,e){c.checkValidOp(t),c.checkValidOp(e);for(var n=l(t),i=0;i<e.length;i++)c.append(n,e[i]);return n},c.normalize=function(t){var e=[];t=o(t)?t:[t];for(var n=0;n<t.length;n++){var i=t[n];null==i.p&&(i.p=[]),c.append(e,i)}return e},c.commonLengthForOps=function(t,e){var n=t.p.length,i=e.p.length;if((null!=t.na||t.t)&&n++,(null!=e.na||e.t)&&i++,0===n)return-1;if(0===i)return null;n--,i--;for(var r=0;r<n;r++){var o=t.p[r];if(r>=i||o!==e.p[r])return null}return n},c.canOpAffectPath=function(t,e){return null!=c.commonLengthForOps({p:e},t)},c.transformComponent=function(t,e,n,o){e=l(e);var s=c.commonLengthForOps(n,e),h=c.commonLengthForOps(e,n),u=e.p.length,p=n.p.length;if((null!=e.na||e.t)&&u++,(null!=n.na||n.t)&&p++,null!=h&&p>u&&e.p[h]==n.p[h])if(void 0!==e.ld){var f=l(n);f.p=f.p.slice(u),e.ld=c.apply(l(e.ld),[f])}else if(void 0!==e.od){var f=l(n);f.p=f.p.slice(u),e.od=c.apply(l(e.od),[f])}if(null!=s){var d=u==p,f=n;if(null==e.si&&null==e.sd||null==n.si&&null==n.sd||(i(e),f=l(n),i(f)),f.t&&a[f.t]){if(e.t&&e.t===f.t){var v=a[e.t].transform(e.o,f.o,o);if(v.length>0)if(null!=e.si||null!=e.sd)for(var g=e.p,y=0;y<v.length;y++)e.o=[v[y]],e.p=g.slice(),r(e),c.append(t,e);else e.o=v,c.append(t,e);return t}}else if(void 0!==n.na);else if(void 0!==n.li&&void 0!==n.ld){if(n.p[s]===e.p[s]){if(!d)return t;if(void 0!==e.ld){if(void 0===e.li||"left"!==o)return t;e.ld=l(n.li)}}}else if(void 0!==n.li)void 0!==e.li&&void 0===e.ld&&d&&e.p[s]===n.p[s]?"right"===o&&e.p[s]++:n.p[s]<=e.p[s]&&e.p[s]++,void 0!==e.lm&&d&&n.p[s]<=e.lm&&e.lm++;else if(void 0!==n.ld){if(void 0!==e.lm&&d){if(n.p[s]===e.p[s])return t;var g=n.p[s],m=e.p[s],b=e.lm;(g<b||g===b&&m<b)&&e.lm--}if(n.p[s]<e.p[s])e.p[s]--;else if(n.p[s]===e.p[s]){if(p<u)return t;if(void 0!==e.ld){if(void 0===e.li)return t;delete e.ld}}}else if(void 0!==n.lm)if(void 0!==e.lm&&u===p){var m=e.p[s],b=e.lm,_=n.p[s],w=n.lm;if(_!==w)if(m===_){if("left"!==o)return t;e.p[s]=w,m===b&&(e.lm=w)}else m>_&&e.p[s]--,m>w?e.p[s]++:m===w&&_>w&&(e.p[s]++,m===b&&e.lm++),b>_?e.lm--:b===_&&b>m&&e.lm--,b>w?e.lm++:b===w&&(w>_&&b>m||w<_&&b<m?"right"===o&&e.lm++:b>m?e.lm++:b===_&&e.lm--)}else if(void 0!==e.li&&void 0===e.ld&&d){var m=n.p[s],b=n.lm;g=e.p[s],g>m&&e.p[s]--,g>b&&e.p[s]++}else{var m=n.p[s],b=n.lm;g=e.p[s],g===m?e.p[s]=b:(g>m&&e.p[s]--,g>b?e.p[s]++:g===b&&m>b&&e.p[s]++)}else if(void 0!==n.oi&&void 0!==n.od){if(e.p[s]===n.p[s]){if(void 0===e.oi||!d)return t;if("right"===o)return t;e.od=n.oi}}else if(void 0!==n.oi){if(void 0!==e.oi&&e.p[s]===n.p[s]){if("left"!==o)return t;c.append(t,{p:e.p,od:n.oi})}}else if(void 0!==n.od&&e.p[s]==n.p[s]){if(!d)return t;if(void 0===e.oi)return t;delete e.od}}return c.append(t,e),t},n(14)(c,c.transformComponent,c.checkValidOp,c.append);var u=n(15);c.registerSubtype(u),t.exports=c},function(t,e){function n(t,e,n,i){var r=function(t,n,i,r){e(i,t,n,"left"),e(r,n,t,"right")},o=t.transformX=function(t,e){n(t),n(e);for(var s=[],l=0;l<e.length;l++){for(var c=e[l],a=[],h=0;h<t.length;){var u=[];if(r(t[h],c,a,u),h++,1!==u.length){if(0===u.length){for(var p=h;p<t.length;p++)i(a,t[p]);c=null;break}for(var f=o(t.slice(h),u),d=0;d<f[0].length;d++)i(a,f[0][d]);for(var v=0;v<f[1].length;v++)i(s,f[1][v]);c=null;break}c=u[0]}null!=c&&i(s,c),t=a}return[t,s]};t.transform=function(t,n,i){if("left"!==i&&"right"!==i)throw new Error("type must be 'left' or 'right'");return 0===n.length?t:1===t.length&&1===n.length?e([],t[0],n[0],i):"left"===i?o(t,n)[0]:o(n,t)[1]}}t.exports=n},function(t,e,n){var i=t.exports={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(t){if(null!=t&&"string"!=typeof t)throw new Error("Initial data must be a string");return t||""}},r=function(t,e,n){return t.slice(0,e)+n+t.slice(e)},o=function(t){if("number"!=typeof t.p)throw new Error("component missing position field");if("string"==typeof t.i==("string"==typeof t.d))throw new Error("component needs an i or d field");if(t.p<0)throw new Error("position cannot be negative")},s=function(t){for(var e=0;e<t.length;e++)o(t[e])};i.apply=function(t,e){var n;s(e);for(var i=0;i<e.length;i++){var o=e[i];if(null!=o.i)t=r(t,o.p,o.i);else{if(n=t.slice(o.p,o.p+o.d.length),o.d!==n)throw new Error("Delete component '"+o.d+"' does not match deleted text '"+n+"'");t=t.slice(0,o.p)+t.slice(o.p+o.d.length)}}return t};var l=i._append=function(t,e){if(""!==e.i&&""!==e.d)if(0===t.length)t.push(e);else{var n=t[t.length-1];null!=n.i&&null!=e.i&&n.p<=e.p&&e.p<=n.p+n.i.length?t[t.length-1]={i:r(n.i,e.p-n.p,e.i),p:n.p}:null!=n.d&&null!=e.d&&e.p<=n.p&&n.p<=e.p+e.d.length?t[t.length-1]={d:r(e.d,n.p-e.p,n.d),p:e.p}:t.push(e)}};i.compose=function(t,e){s(t),s(e);for(var n=t.slice(),i=0;i<e.length;i++)l(n,e[i]);return n},i.normalize=function(t){var e=[];null==t.i&&null==t.p||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];null==i.p&&(i.p=0),l(e,i)}return e};var c=function(t,e,n){return null!=e.i?e.p<t||e.p===t&&n?t+e.i.length:t:t<=e.p?t:t<=e.p+e.d.length?e.p:t-e.d.length};i.transformCursor=function(t,e,n){for(var i="right"===n,r=0;r<e.length;r++)t=c(t,e[r],i);return t};var a=i._tc=function(t,e,n,i){if(o(e),o(n),null!=e.i)l(t,{i:e.i,p:c(e.p,n,"right"===i)});else if(null!=n.i){var r=e.d;e.p<n.p&&(l(t,{d:r.slice(0,n.p-e.p),p:e.p}),r=r.slice(n.p-e.p)),""!==r&&l(t,{d:r,p:e.p+n.i.length})}else if(e.p>=n.p+n.d.length)l(t,{d:e.d,p:e.p-n.d.length});else if(e.p+e.d.length<=n.p)l(t,e);else{var s={d:"",p:e.p};e.p<n.p&&(s.d=e.d.slice(0,n.p-e.p)),e.p+e.d.length>n.p+n.d.length&&(s.d+=e.d.slice(n.p+n.d.length-e.p));var a=Math.max(e.p,n.p),h=Math.min(e.p+e.d.length,n.p+n.d.length),u=e.d.slice(a-e.p,h-e.p),p=n.d.slice(a-n.p,h-n.p);if(u!==p)throw new Error("Delete ops delete different text in the same region of the document");""!==s.d&&(s.p=c(s.p,n),l(t,s))}return t},h=function(t){return null!=t.i?{d:t.i,p:t.p}:{i:t.d,p:t.p}};i.invert=function(t){t=t.slice().reverse();for(var e=0;e<t.length;e++)t[e]=h(t[e]);return t},n(14)(i,a,s,l)},function(t,e,n){(function(e){function i(t,e,n,i,o,s,l){r.EventEmitter.call(this),this.action=t,this.connection=e,this.id=n,this.collection=i,this.query=o,this.results=null,s&&s.results&&(this.results=s.results,delete s.results),this.extra=void 0,this.options=s,this.callback=l,this.ready=!1,this.sent=!1}var r=n(7);t.exports=i,r.mixin(i),i.prototype.hasPending=function(){return!this.ready},i.prototype.send=function(){if(this.connection.canSend){var t={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(t.o=this.options),this.results){for(var e=[],n=0;n<this.results.length;n++){var i=this.results[n];e.push([i.id,i.version])}t.r=e}this.connection.send(t),this.sent=!0}},i.prototype.destroy=function(t){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),t&&e.nextTick(t)},i.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},i.prototype._handleFetch=function(t,e,n){this.connection._destroyQuery(this),this._handleResponse(t,e,n)},i.prototype._handleSubscribe=function(t,e,n){this._handleResponse(t,e,n)},i.prototype._handleResponse=function(t,e,n){var i=this.callback;if(this.callback=null,t)return this._finishResponse(t,i);if(!e)return this._finishResponse(null,i);var r=this,o=1,s=function(t){return t?r._finishResponse(t,i):void(--o||r._finishResponse(null,i))};if(Array.isArray(e))o+=e.length,this.results=this._ingestSnapshots(e,s),this.extra=n;else for(var l in e){o++;var c=e[l],a=this.connection.get(c.c||this.collection,l);a.ingestSnapshot(c,s)}s()},i.prototype._ingestSnapshots=function(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=this.connection.get(r.c||this.collection,r.d);o.ingestSnapshot(r,e),n.push(o)}return n},i.prototype._finishResponse=function(t,e){return this.emit("ready"),this.ready=!0,t?(this.connection._destroyQuery(this),e?e(t):this.emit("error",t)):void(e&&e(null,this.results,this.extra))},i.prototype._handleError=function(t){this.emit("error",t)},i.prototype._handleDiff=function(t){for(var e=0;e<t.length;e++){var n=t[e];"insert"===n.type&&(n.values=this._ingestSnapshots(n.values))}for(var e=0;e<t.length;e++){var n=t[e];switch(n.type){case"insert":var i=n.values;Array.prototype.splice.apply(this.results,[n.index,0].concat(i)),this.emit("insert",i,n.index);break;case"remove":var r=n.howMany||1,o=this.results.splice(n.index,r);this.emit("remove",o,n.index);break;case"move":var r=n.howMany||1,s=this.results.splice(n.from,r);Array.prototype.splice.apply(this.results,[n.to,0].concat(s)),this.emit("move",s,n.from,n.to)}}this.emit("changed",this.results)},i.prototype._handleExtra=function(t){this.extra=t,this.emit("extra",t)}}).call(e,n(5))},function(t,e){function n(){}e.doNothing=n,e.hasKeys=function(t){for(var e in t)return!0;return!1}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(19),l=i(s),c=function(){function t(e){var n=this;r(this,t),this.editor=e.ace,this.editor.id=e.id+"-"+e.path,this.editor.$blockScrolling=1/0,this.session=this.editor.getSession(),this.newline=this.session.getDocument().getNewLineCharacter(),this.path=e.path,this.doc=e.doc,this.pluginWS=e.pluginWS,this.plugins=e.plugins||[],this.logger=new l.default({prefix:"shareace"}),l.default.disable("*"),this.plugins.forEach(function(t){t(n.pluginWS,n.editor)}),this.suppress=!1,this.setInitialValue(),this.$onLocalChange=this.onLocalChange.bind(this),this.$onRemoteChange=this.onRemoteChange.bind(this),this.listen()}return o(t,[{key:"setInitialValue",value:function(){this.suppress=!0,this.session.setValue(this.doc.data[this.path[0]]),this.suppress=!1}},{key:"listen",value:function(){this.session.on("change",this.$onLocalChange),this.doc.on("op",this.$onRemoteChange)}},{key:"unlisten",value:function(){this.session.removeListener("change",this.$onLocalChange),this.doc.on("op",this.$onRemoteChange)}},{key:"deltaTransform",value:function(t){var e=this.session.getDocument(),n={},i=e.positionToIndex(t.start),r=e.positionToIndex(t.end);n.p=this.path.concat(i),this.logger.log("start: "+i+" end: "+r);var o=void 0;if("insert"===t.action)o="si";else{if("remove"!==t.action)throw new Error("action "+o+" not supported");o="sd"}var s=t.lines.join("\n");return n[o]=s,n}},{key:"opTransform",value:function(t){function e(t){var e=t.p[t.p.length-1],i=n.session.doc.indexToPosition(e,0),r=i,o=void 0,s=void 0,l=void 0;if("sd"in t){o="remove",s=t.sd.split("\n");var c=s.reduce(function(t,e){return t+e.length},s.length-1);l=n.session.doc.indexToPosition(e+c,0)}else{if(!("si"in t))throw new Error("Invalid Operation: "+JSON.stringify(t));o="insert",s=t.si.split("\n"),l=1===s.length?{row:r.row,column:r.column+t.si.length}:{row:r.row+(s.length-1),column:s[s.length-1].length}}var a={start:r,end:l,action:o,lines:s};return a}var n=this,i=t.map(e);return i}},{key:"onLocalChange",value:function(t){var e=this;if(this.logger.log("*local*: fired "+Date.now()),this.logger.log("*local*: delta received: "+JSON.stringify(t)),this.suppress)return void this.logger.log("*local*: local delta, _skipping_");var n=this.deltaTransform(t);this.logger.log("*local*: transformed op: "+JSON.stringify(n));var i=function(t){if(t)throw t;e.logger.log("*local*: op submitted")};this.doc.submitOp(n,{source:this},i)}},{key:"onRemoteChange",value:function(t,e){this.logger.log("*remote*: fired "+Date.now());var n=this,i=t[0].p.slice(0,t[0].p.length-1).toString();if(this.logger.log(i),e===n)return void this.logger.log("*remote*: op origin is self; _skipping_");if(i!==this.path.toString())return void this.logger.log("*remote*: not from my path; _skipping_");var r=this.opTransform(t);this.logger.log("*remote*: op received: "+JSON.stringify(t)),this.logger.log("*remote*: transformed delta: "+JSON.stringify(r)),n.suppress=!0,n.session.getDocument().applyDeltas(r),n.suppress=!1,this.logger.log("*remote*: session value"),this.logger.log(JSON.stringify(this.session.getValue())),this.logger.log("*remote*: delta applied")}}]),t}();e.default=c},function(t,e,n){(function(e){!function(){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=t||{};var e=void 0===t.prefix?"":t.prefix;return e=p(e),e&&h(e,g)?u(e,g):(this.alignOutput=Boolean(t.alignOutput),this.markdown=void 0===t.markdown||t.markdown,this.prefix=e,g.push(this),i(g),v()?(this.prefixColor=m[y%m.length],y+=1):d()&&(this.prefixColor=E()),this)}function i(t){var e=t.sort(function(t,e){return e.prefix.length-t.prefix.length})[0];t.forEach(function(t){if(t.alignOutput){var n=new Array(Math.max(e.prefix.length-t.prefix.length+1,0)).join(" ");t.prefix=t.prefix+n}})}function r(t){for(var e=[],n=o(t);n;)t=t.replace(n.rule.regexp,n.rule.replacer),v()&&(e.push(n.rule.style),e.push("")),n=o(t);return{text:t,styles:e}}function o(t){var e=[],n=[];return v()?n=[{regexp:/\*([^\*]+)\*/,replacer:function(t,e){return"%c"+e+"%c"},style:"font-weight:bold;"},{regexp:/_([^_]+)_/,replacer:function(t,e){return"%c"+e+"%c"},style:"font-style:italic;"},{regexp:/`([^`]+)`/,replacer:function(t,e){return"%c"+e+"%c"},style:"background:#FDF6E3; color:#586E75; padding:1px 5px; border-radius:4px;"}]:d()&&(n=[{regexp:/\*([^\*]+)\*/,replacer:function(t,e){return"["+b.modifiers.bold[0]+"m"+e+"["+b.modifiers.bold[1]+"m"}},{regexp:/_([^_]+)_/,replacer:function(t,e){return"["+b.modifiers.italic[0]+"m"+e+"["+b.modifiers.italic[1]+"m"}},{regexp:/`([^`]+)`/,replacer:function(t,e){return"["+b.bgColors.bgYellow[0]+"m["+b.colors.black[0]+"m "+e+" ["+b.colors.black[1]+"m["+b.bgColors.bgYellow[1]+"m"}}]),n.forEach(function(n){var i=t.match(n.regexp);i&&e.push({rule:n,match:i})}),0===e.length?null:(e.sort(function(t,e){return t.match.index-e.match.index}),e[0])}function s(t,e){var n,i=[];return e.prefix?f()?(i.push("%c"+e.prefix+"%c "),i.push("color:"+e.prefixColor+"; font-weight:bold;","")):i.push("["+e.prefix+"] "):i.push(""),"string"==typeof t[0]?e.markdown&&f()?(n=r(t[0]),i[0]=i[0]+n.text,i=i.concat(n.styles)):i[0]=i[0]+t[0]:i[0]=t[0],t.length>1&&(i=i.concat(t.splice(1))),i}function l(t,e,n){var i=[];return n.prefix&&(f()?i[0]="["+n.prefixColor[0]+"m["+b.modifiers.bold[0]+"m"+n.prefix+"["+b.modifiers.bold[1]+"m["+n.prefixColor[1]+"m":i[0]="["+n.prefix+"]"),"warn"===e?i[0]="["+b.colors.yellow[0]+"m⚠["+b.colors.yellow[1]+"m "+(i[0]||""):"error"===e?i[0]="["+b.colors.red[0]+"m✖["+b.colors.red[1]+"m "+(i[0]||""):"info"===e?i[0]="["+b.colors.blue[0]+"mℹ["+b.colors.blue[1]+"m "+(i[0]||""):"debug"===e&&(i[0]="["+b.colors.gray[0]+"m🐛["+b.colors.gray[1]+"m "+(i[0]||"")),t.forEach(function(t){"string"==typeof t&&n.markdown?i.push(r(t).text):i.push(t)}),i}function c(t){var i=null;"undefined"!=typeof e&&void 0!=={NODE_ENV:"production"}&&0===_.length&&(void 0!=={NODE_ENV:"production"}.NODE_DEBUG&&""!=={NODE_ENV:"production"}.NODE_DEBUG?i="NODE_DEBUG":void 0!=={NODE_ENV:"production"}.DEBUG&&""!=={NODE_ENV:"production"}.DEBUG&&(i="DEBUG"),i&&n.disable("*")({NODE_ENV:"production"})[i].split(",").forEach(function(t){n.enable(t)}));var r=!1;return _.forEach(function(e){"enable"===e.type&&e.regExp.test(t.prefix)?r=!1:"disable"===e.type&&e.regExp.test(t.prefix)&&(r=!0)}),r}function a(t){return new RegExp("^"+t.replace(/\*/g,".*?")+"$")}function h(t,e){var n=!1;return e.forEach(function(e){if(e.prefix===t)return void(n=!0)}),n}function u(t,e){var n;return e.forEach(function(e){if(e.prefix===t)return void(n=e)}),n}function p(t){return"string"==typeof t?t.replace(/%c/g,""):t}function f(){if(v()){var t="WebkitAppearance"in document.documentElement.style,n=window.console&&(console.firebug||console.exception&&console.table),i=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31;return t||n||i}if(d())return!(e.stdout&&!e.stdout.isTTY)&&("win32"===e.platform||("COLORTERM"in{NODE_ENV:"production"}||"dumb"!=={NODE_ENV:"production"}.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test({NODE_ENV:"production"}.TERM)))}function d(){return"undefined"!=typeof t&&"undefined"!=typeof t.exports}function v(){return"undefined"!=typeof window}var g=[],y=0,m=["#B58900","#CB4B16","#DC322F","#D33682","#6C71C4","#268BD2","#2AA198","#859900"],b={modifiers:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},colors:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39]},bgColors:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49]}},_=[];n.enable=function(){Array.prototype.forEach.call(arguments,function(t){"-"===t[0]&&n.disable(t.substr(1));var e=a(t);"*"===t?_=[]:_.push({type:"enable",regExp:e})})},n.disable=function(){Array.prototype.forEach.call(arguments,function(t){"-"===t[0]&&n.enable(t.substr(1));var e=a(t);"*"===t?_=[{type:"disable",regExp:e}]:_.push({type:"disable",regExp:e})})};var w=["debug","log","info","warn","error"];w.forEach(function(t){n.prototype[t]=function(){if(!c(this)){var e,n=Array.prototype.slice.call(arguments,0);v()?(e=s(n,this),Function.prototype.apply.call(console[t]||console.log,console,e)):d()&&(e=l(n,t,this),(console[t]||console.log).apply(console,e))}}});var E=function(){var t=0,e=[[31,39],[32,39],[33,39],[34,39],[35,39],[36,39]];return function(){return e[(t+=1)%e.length]}}();d()?t.exports=n:v()&&(window.Logdown=n)}()}).call(e,n(5))}])});